var messageDelay = 1500;  // How long to display status messages (in milliseconds)
var hiddenInquiryProductCode = '';
var hiddenInquiryProductName = '';
var hiddenInquiryProductDescription = '';


jQuery(document).ready(function() {
  
	jQuery('#hiddenInquiryForm').hide().submit(hiddenInquirySubmitForm).addClass('positioned');

	jQuery('a[href="#hiddenInquiryLink"]').click( function() {
		jQuery('#hiddenInquiryProductCodeDisplay').text(hiddenInquiryProductCode);
		jQuery('#hiddenInquiryProductCode').val(hiddenInquiryProductCode);
		jQuery('#hiddenInquiryProductNameDisplay').text(hiddenInquiryProductName);
		jQuery('#hiddenInquiryProductName').val(hiddenInquiryProductName);
		jQuery('#hiddenInquiryProductDescription').val(hiddenInquiryProductDescription);
		jQuery('#hiddenInquiryForm').fadeIn( 'slow', function() {
			jQuery('#hiddenInquirySenderFirstName').focus(); // focus the name field
		} )
		return false;
	} );

	jQuery('#hiddenInquiryCancelButton').click( function() { 
		jQuery('#hiddenInquiryForm').fadeOut();
	} );  


});



// Submit the form via Ajax

function hiddenInquirySubmitForm() {
	var hiddenInquiryForm = jQuery(this);

	var email = jQuery('#hiddenInquirySenderEmail').val();

	var empty = false;
	var bademail = false;
	if (!jQuery('#hiddenInquirySenderFirstName').val()) empty = true;
	if (!jQuery('#hiddenInquirySenderLastName').val()) empty = true;
	if (!jQuery('#hiddenInquirySenderEmail').val()) empty = true;
	//if (!jQuery('#hiddenInquiryMessage').val()) empty = true;
	
	// email validator -- don't really need this if you want to use html5 and type=email (but the css was weird).
	var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/igm;
	if (!re.test(email)) bademail = true;
	
	if (bademail) {
		jQuery('#hiddenInquiryBademailMessage').fadeIn().delay(messageDelay).fadeOut();
		hiddenInquiryForm.fadeOut().delay(messageDelay).fadeIn();
	} else if (empty) {
		jQuery('#hiddenInquiryIncompleteMessage').fadeIn().delay(messageDelay).fadeOut();
		hiddenInquiryForm.fadeOut().delay(messageDelay).fadeIn();
	} else {
		jQuery('#hiddenInquirySendingMessage').fadeIn();
		hiddenInquiryForm.fadeOut();

		jQuery.ajax( {
			url: hiddenInquiryForm.attr( 'action' ) + "?ajax=true",
			type: hiddenInquiryForm.attr( 'method' ),
			data: hiddenInquiryForm.serialize(),
			success: submitFinished
		} );
	}
  return false; // Prevent the default form submission
}


// Handle the Ajax response

function submitFinished( response ) {
  response = jQuery.trim( response );
  jQuery('#hiddenInquirySendingMessage').fadeOut();

  if ( response == "success" ) {
    jQuery('#hiddenInquirySuccessMessage').fadeIn().delay(messageDelay).fadeOut();
    jQuery('#hiddenInquirySenderFirstName').val( "" );
    jQuery('#hiddenInquirySenderLastName').val( "" );
    jQuery('#hiddenInquirySenderEmail').val( "" );
    jQuery('#hiddenInquiryMessage').val( "" );
  } else {
    jQuery('#hiddenInquiryFailureMessage').fadeIn().delay(messageDelay).fadeOut(); // Display failure message
    jQuery('.hiddenInquiryForm').delay(messageDelay+500).fadeIn(); //redislpay form
  }
}


